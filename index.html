<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Horários - Ciências Econômicas UESC</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #2ecc71;
            --warning: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 500;
        }
        
        .logo-img {
            width: 50px;
            height: 50px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary);
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background 0.3s;
            font-weight: 500;
        }
        
        nav a:hover, nav a.active {
            background: rgba(255,255,255,0.2);
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .card-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 500;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        input, select, button {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background: var(--secondary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
            margin-top: 10px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .btn-danger {
            background: var(--accent);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 500;
            color: var(--primary);
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 6px 10px;
            font-size: 0.9rem;
            width: auto;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .schedule-grid {
            display: grid;
            grid-template-columns: 100px repeat(6, 1fr);
            gap: 1px;
            background-color: #ddd;
            border: 1px solid #ddd;
        }
        
        .grid-header, .grid-cell {
            padding: 12px;
            background-color: white;
            min-height: 80px;
        }
        
        .grid-header {
            font-weight: 500;
            text-align: center;
            background-color: #f8f9fa;
        }
        
        .conflict {
            background-color: #ffeceb;
            border: 1px solid var(--accent);
        }
        
        .print-section {
            background-color: white;
            padding: 30px;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .print-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            color: #7f8c8d;
            border-top: 1px solid #eee;
        }
        
        .time-slot {
            font-size: 0.85rem;
            margin-bottom: 5px;
            color: #666;
        }
        
        .schedule-entry {
            background-color: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--secondary);
        }
        
        .error {
            color: var(--accent);
            padding: 10px;
            background-color: #ffeceb;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        @media print {
            nav, .print-actions, .card-header button {
                display: none;
            }
            
            .container {
                width: 100%;
                max-width: 100%;
            }
            
            .print-section {
                box-shadow: none;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <div class="logo-img">CE</div>
                <h1>Gestão de Horários - Ciências Econômicas UESC</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" data-tab="dashboard">Dashboard</a></li>
                    <li><a href="#" data-tab="professores">Professores</a></li>
                    <li><a href="#" data-tab="disciplinas">Disciplinas</a></li>
                    <li><a href="#" data-tab="turmas">Turmas</a></li>
                    <li><a href="#" data-tab="salas">Salas</a></li>
                    <li><a href="#" data-tab="horarios">Horários</a></li>
                    <li><a href="#" data-tab="imprimir">Imprimir</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Visão Geral do Sistema</h2>
                </div>
                <p>Bem-vindo ao sistema de gestão de horários do curso de Ciências Econômicas da UESC.</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <h3>Turno Matutino</h3>
                        <ul>
                            <li>Segunda a Sexta: 7:30 às 12:30</li>
                            <li>Períodos: 7:30-8:20, 8:20-9:10, 9:10-10:00, 10:00-10:50, 10:50-11:40, 11:40-12:30</li>
                            <li>9 semestres</li>
                        </ul>
                    </div>
                    
                    <div class="form-group">
                        <h3>Turno Noturno</h3>
                        <ul>
                            <li>Segunda a Sexta: 18:40 às 22:00</li>
                            <li>Sábado: 7:30 às 12:30</li>
                            <li>Períodos: 18:40-19:30, 19:30-20:20, 20:20-21:10, 21:10-22:00</li>
                            <li>10 semestres</li>
                        </ul>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <div class="card">
                            <h3>Resumo</h3>
                            <p id="professor-count">Professores: 0</p>
                            <p id="disciplina-count">Disciplinas: 0</p>
                            <p id="turma-count">Turmas: 0</p>
                            <p id="sala-count">Salas: 0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Professores -->
        <div id="professores" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Gerenciamento de Professores</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="prof-nome">Nome Completo</label>
                        <input type="text" id="prof-nome" placeholder="Ex: Carlos Silva">
                    </div>
                    <div class="form-group">
                        <label for="prof-email">Email</label>
                        <input type="email" id="prof-email" placeholder="Ex: professor@uesc.br">
                    </div>
                </div>
                
                <button id="add-prof" class="btn-success">Adicionar Professor</button>
                
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="professores-lista">
                        <tr><td colspan="4" class="loading">Carregando professores...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Disciplinas -->
        <div id="disciplinas" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Gerenciamento de Disciplinas</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="disc-codigo">Código</label>
                        <input type="text" id="disc-codigo" placeholder="Ex: ECO101">
                    </div>
                    <div class="form-group">
                        <label for="disc-nome">Nome da Disciplina</label>
                        <input type="text" id="disc-nome" placeholder="Ex: Introdução à Economia">
                    </div>
                    <div class="form-group">
                        <label for="disc-ch">Carga Horária</label>
                        <input type="number" id="disc-ch" placeholder="Ex: 60">
                    </div>
                </div>
                
                <button id="add-disc" class="btn-success">Adicionar Disciplina</button>
                
                <table>
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Nome</th>
                            <th>Carga Horária</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="disciplinas-lista">
                        <tr><td colspan="4" class="loading">Carregando disciplinas...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Turmas -->
        <div id="turmas" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Gerenciamento de Turmas</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="turma-codigo">Código da Turma</label>
                        <select id="turma-codigo">
                            <option value="T01">T01 (Noturno Regular)</option>
                            <option value="T02">T02 (Matutino Regular)</option>
                            <option value="T03">T03 (Noturno Extra)</option>
                            <option value="T04">T04 (Matutino Extra)</option>
                            <option value="T05">T05 (Noturno Extra)</option>
                            <option value="T06">T06 (Matutino Extra)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="turma-semestre">Semestre</label>
                        <input type="number" id="turma-semestre" min="1" max="10" placeholder="Ex: 1">
                    </div>
                    <div class="form-group">
                        <label for="turma-turno">Turno</label>
                        <select id="turma-turno">
                            <option value="matutino">Matutino</option>
                            <option value="noturno">Noturno</option>
                        </select>
                    </div>
                </div>
                
                <button id="add-turma" class="btn-success">Adicionar Turma</button>
                
                <table>
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Semestre</th>
                            <th>Turno</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="turmas-lista">
                        <tr><td colspan="4" class="loading">Carregando turmas...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Salas -->
        <div id="salas" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Gerenciamento de Salas</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sala-nome">Nome/Identificação</label>
                        <input type="text" id="sala-nome" placeholder="Ex: Sala 101">
                    </div>
                    <div class="form-group">
                        <label for="sala-capacidade">Capacidade</label>
        <input type="number" id="sala-capacidade" placeholder="Ex: 30">
                    </div>
                    <div class="form-group">
                        <label for="sala-tipo">Tipo de Sala</label>
                        <select id="sala-tipo">
                            <option value="Sala de Aula">Sala de Aula</option>
                            <option value="Laboratório">Laboratório</option>
                            <option value="Auditório">Auditório</option>
                        </select>
                    </div>
                </div>
                
                <button id="add-sala" class="btn-success">Adicionar Sala</button>
                
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Capacidade</th>
                            <th>Tipo</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="salas-lista">
                        <tr><td colspan="4" class="loading">Carregando salas...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Horários -->
        <div id="horarios" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Alocação de Horários</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="horario-turma">Selecione a Turma</label>
                        <select id="horario-turma">
                            <option value="">Carregando turmas...</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="horario-disciplina">Disciplina</label>
                        <select id="horario-disciplina">
                            <option value="">Carregando disciplinas...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="horario-professor">Professor</label>
                        <select id="horario-professor">
                            <option value="">Carregando professores...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="horario-sala">Sala</label>
                        <select id="horario-sala">
                            <option value="">Carregando salas...</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="horario-dia">Dia da Semana</label>
                        <select id="horario-dia">
                            <option value="segunda">Segunda-feira</option>
                            <option value="terca">Terça-feira</option>
                            <option value="quarta">Quarta-feira</option>
                            <option value="quinta">Quinta-feira</option>
                            <option value="sexta">Sexta-feira</option>
                            <option value="sabado">Sábado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="horario-inicio">Horário de Início</label>
                        <select id="horario-inicio">
                            <optgroup label="Horários Matutinos">
                                <option value="07:30">07:30</option>
                                <option value="08:20">08:20</option>
                                <option value="09:10">09:10</option>
                                <option value="10:00">10:00</option>
                                <option value="10:50">10:50</option>
                                <option value="11:40">11:40</option>
                            </optgroup>
                            <optgroup label="Horários Noturnos">
                                <option value="18:40">18:40</option>
                                <option value="19:30">19:30</option>
                                <option value="20:20">20:20</option>
                                <option value="21:10">21:10</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="horario-duracao">Duração (em períodos)</label>
                        <select id="horario-duracao">
                            <option value="1">1 período (50 min)</option>
                            <option value="2">2 períodos (100 min)</option>
                        </select>
                    </div>
                </div>
                
                <button id="add-horario" class="btn-success">Adicionar Horário</button>
                <div id="conflict-alert" style="color: var(--accent); margin-top: 15px; display: none;"></div>
                
                <h3 style="margin-top: 30px;">Grade de Horários</h3>
                <div id="schedule-container">
                    <p>Selecione uma turma para ver a grade de horários</p>
                </div>
            </div>
        </div>
        
        <!-- Impressão -->
        <div id="imprimir" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Impressão de Horários</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="print-type">Tipo de Horário</label>
                        <select id="print-type">
                            <option value="turma">Por Turma/Semestre</option>
                            <option value="professor">Por Professor</option>
                        </select>
                    </div>
                    <div class="form-group" id="print-turma-container">
                        <label for="print-turma">Selecione a Turma</label>
                        <select id="print-turma">
                            <option value="">Carregando turmas...</option>
                        </select>
                    </div>
                    <div class="form-group" id="print-professor-container" style="display: none;">
                        <label for="print-professor">Selecione o Professor</label>
                        <select id="print-professor">
                            <option value="">Carregando professores...</option>
                        </select>
                    </div>
                </div>
                
                <button id="generate-print" class="btn-success">Gerar para Impressão</button>
                
                <div class="print-section" id="print-output">
                    <p>Selecione as opções acima e clique em "Gerar para Impressão"</p>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>Sistema de Gestão de Horários - Curso de Ciências Econômicas UESC &copy; 2025</p>
        </div>
    </footer>

    <script>
        // Configuração do Firebase (substitua com suas credenciais)
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "SEU_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Referências para as coleções
        const professoresRef = db.collection('professores');
        const disciplinasRef = db.collection('disciplinas');
        const turmasRef = db.collection('turmas');
        const salasRef = db.collection('salas');
        const horariosRef = db.collection('horarios');

        // Elementos da interface
        const tabLinks = document.querySelectorAll('nav a');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Inicialização do sistema
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar navegação por abas
            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Atualizar aba ativa
                    tabLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Mostrar conteúdo da aba
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === targetTab) {
                            content.classList.add('active');
                            
                            // Carregar dados específicos da aba
                            if (targetTab === 'horarios') {
                                loadHorariosData();
                            } else if (targetTab === 'imprimir') {
                                loadPrintData();
                            }
                        }
                    });
                });
            });

            // Carregar dados iniciais
            loadCounts();
            loadProfessores();
            loadDisciplinas();
            loadTurmas();
            loadSalas();
            
            // Configurar eventos
            document.getElementById('add-prof').addEventListener('click', addProfessor);
            document.getElementById('add-disc').addEventListener('click', addDisciplina);
            document.getElementById('add-turma').addEventListener('click', addTurma);
            document.getElementById('add-sala').addEventListener('click', addSala);
            document.getElementById('add-horario').addEventListener('click', addHorario);
            document.getElementById('generate-print').addEventListener('click', generatePrint);
            
            // Alternar entre turma e professor na impressão
            document.getElementById('print-type').addEventListener('change', function(e) {
                if (e.target.value === 'turma') {
                    document.getElementById('print-turma-container').style.display = 'block';
                    document.getElementById('print-professor-container').style.display = 'none';
                } else {
                    document.getElementById('print-turma-container').style.display = 'none';
                    document.getElementById('print-professor-container').style.display = 'block';
                }
            });
            
            // Atualizar grade quando uma turma for selecionada
            document.getElementById('horario-turma').addEventListener('change', function() {
                if (this.value) {
                    generateScheduleGrid(this.value);
                } else {
                    document.getElementById('schedule-container').innerHTML = '<p>Selecione uma turma para ver a grade de horários</p>';
                }
            });
        });

        // Funções para carregar dados
        function loadCounts() {
            professoresRef.get().then(snap => {
                document.getElementById('professor-count').textContent = `Professores: ${snap.size}`;
            });
            
            disciplinasRef.get().then(snap => {
                document.getElementById('disciplina-count').textContent = `Disciplinas: ${snap.size}`;
            });
            
            turmasRef.get().then(snap => {
                document.getElementById('turma-count').textContent = `Turmas: ${snap.size}`;
            });
            
            salasRef.get().then(snap => {
                document.getElementById('sala-count').textContent = `Salas: ${snap.size}`;
            });
        }

        function loadProfessores() {
            const lista = document.getElementById('professores-lista');
            lista.innerHTML = '<tr><td colspan="4" class="loading">Carregando professores...</td></tr>';
            
            professoresRef.get().then(snap => {
                lista.innerHTML = '';
                
                if (snap.empty) {
                    lista.innerHTML = '<tr><td colspan="4">Nenhum professor cadastrado</td></tr>';
                    return;
                }
                
                snap.forEach(doc => {
                    const prof = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${doc.id.substring(0, 8)}</td>
                        <td>${prof.nome}</td>
                        <td>${prof.email || ''}</td>
                        <td class="actions">
                            <button class="btn-danger action-btn" data-id="${doc.id}">Excluir</button>
                        </td>
                    `;
                    lista.appendChild(row);
                });
                
                // Adicionar eventos de exclusão
                document.querySelectorAll('#professores-lista .btn-danger').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        professoresRef.doc(id).delete().then(() => {
                            loadProfessores();
                            loadCounts();
                        });
                    });
                });
            });
        }

        function loadDisciplinas() {
            const lista = document.getElementById('disciplinas-lista');
            lista.innerHTML = '<tr><td colspan="4" class="loading">Carregando disciplinas...</td></tr>';
            
            disciplinasRef.get().then(snap => {
                lista.innerHTML = '';
                
                if (snap.empty) {
                    lista.innerHTML = '<tr><td colspan="4">Nenhuma disciplina cadastrada</td></tr>';
                    return;
                }
                
                snap.forEach(doc => {
                    const disc = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${disc.codigo}</td>
                        <td>${disc.nome}</td>
                        <td>${disc.cargaHoraria} horas</td>
                        <td class="actions">
                            <button class="btn-danger action-btn" data-id="${doc.id}">Excluir</button>
                        </td>
                    `;
                    lista.appendChild(row);
                });
                
                // Adicionar eventos de exclusão
                document.querySelectorAll('#disciplinas-lista .btn-danger').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        disciplinasRef.doc(id).delete().then(() => {
                            loadDisciplinas();
                            loadCounts();
                        });
                    });
                });
            });
        }

        function loadTurmas() {
            const lista = document.getElementById('turmas-lista');
            lista.innerHTML = '<tr><td colspan="4" class="loading">Carregando turmas...</td></tr>';
            
            turmasRef.get().then(snap => {
                lista.innerHTML = '';
                
                if (snap.empty) {
                    lista.innerHTML = '<tr><td colspan="4">Nenhuma turma cadastrada</td></tr>';
                    return;
                }
                
                snap.forEach(doc => {
                    const turma = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${turma.codigo}</td>
                        <td>${turma.semestre}º Semestre</td>
                        <td>${turma.turno === 'matutino' ? 'Matutino' : 'Noturno'}</td>
                        <td class="actions">
                            <button class="btn-danger action-btn" data-id="${doc.id}">Excluir</button>
                        </td>
                    `;
                    lista.appendChild(row);
                });
                
                // Adicionar eventos de exclusão
                document.querySelectorAll('#turmas-lista .btn-danger').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        turmasRef.doc(id).delete().then(() => {
                            loadTurmas();
                            loadCounts();
                        });
                    });
                });
            });
        }

        function loadSalas() {
            const lista = document.getElementById('salas-lista');
            lista.innerHTML = '<tr><td colspan="4" class="loading">Carregando salas...</td></tr>';
            
            salasRef.get().then(snap => {
                lista.innerHTML = '';
                
                if (snap.empty) {
                    lista.innerHTML = '<tr><td colspan="4">Nenhuma sala cadastrada</td></tr>';
                    return;
                }
                
                snap.forEach(doc => {
                    const sala = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${sala.nome}</td>
                        <td>${sala.capacidade} lugares</td>
                        <td>${sala.tipo}</td>
                        <td class="actions">
                            <button class="btn-danger action-btn" data-id="${doc.id}">Excluir</button>
                        </td>
                    `;
                    lista.appendChild(row);
                });
                
                // Adicionar eventos de exclusão
                document.querySelectorAll('#salas-lista .btn-danger').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const id = btn.getAttribute('data-id');
                        salasRef.doc(id).delete().then(() => {
                            loadSalas();
                            loadCounts();
                        });
                    });
                });
            });
        }

        <script>
        // ... (código anterior permanece igual)

        // Função para carregar dados para a aba de horários
        function loadHorariosData() {
            // Carregar turmas
            const turmaSelect = document.getElementById('horario-turma');
            turmaSelect.innerHTML = '<option value="">Carregando turmas...</option>';
            
            turmasRef.get().then(snap => {
                turmaSelect.innerHTML = '<option value="">Selecione uma turma</option>';
                snap.forEach(doc => {
                    const turma = doc.data();
                    turmaSelect.innerHTML += `<option value="${doc.id}">${turma.codigo} - ${turma.semestre}º Semestre (${turma.turno})</option>`;
                });
            });
            
            // Carregar disciplinas
            const discSelect = document.getElementById('horario-disciplina');
            discSelect.innerHTML = '<option value="">Carregando disciplinas...</option>';
            
            disciplinasRef.get().then(snap => {
                discSelect.innerHTML = '<option value="">Selecione uma disciplina</option>';
                snap.forEach(doc => {
                    const disc = doc.data();
                    discSelect.innerHTML += `<option value="${doc.id}">${disc.codigo} - ${disc.nome}</option>`;
                });
            });
            
            // Carregar professores
            const profSelect = document.getElementById('horario-professor');
            profSelect.innerHTML = '<option value="">Carregando professores...</option>';
            
            professoresRef.get().then(snap => {
                profSelect.innerHTML = '<option value="">Selecione um professor</option>';
                snap.forEach(doc => {
                    const prof = doc.data();
                    profSelect.innerHTML += `<option value="${doc.id}">${prof.nome}</option>`;
                });
            });
            
            // Carregar salas
            const salaSelect = document.getElementById('horario-sala');
            salaSelect.innerHTML = '<option value="">Carregando salas...</option>';
            
            salasRef.get().then(snap => {
                salaSelect.innerHTML = '<option value="">Selecione uma sala</option>';
                snap.forEach(doc => {
                    const sala = doc.data();
                    salaSelect.innerHTML += `<option value="${doc.id}">${sala.nome} (${sala.tipo})</option>`;
                });
            });
        }

        // Funções para adicionar entidades
        function addProfessor() {
            const nome = document.getElementById('prof-nome').value;
            const email = document.getElementById('prof-email').value;
            
            if (!nome) {
                alert('Por favor, preencha o nome do professor');
                return;
            }
            
            professoresRef.add({
                nome: nome,
                email: email
            }).then(() => {
                alert('Professor adicionado com sucesso!');
                document.getElementById('prof-nome').value = '';
                document.getElementById('prof-email').value = '';
                loadProfessores();
                loadCounts();
            }).catch(error => {
                alert('Erro ao adicionar professor: ' + error.message);
            });
        }

        function addDisciplina() {
            const codigo = document.getElementById('disc-codigo').value;
            const nome = document.getElementById('disc-nome').value;
            const cargaHoraria = document.getElementById('disc-ch').value;
            
            if (!codigo || !nome || !cargaHoraria) {
                alert('Por favor, preencha todos os campos');
                return;
            }
            
            disciplinasRef.add({
                codigo: codigo,
                nome: nome,
                cargaHoraria: cargaHoraria
            }).then(() => {
                alert('Disciplina adicionada com sucesso!');
                document.getElementById('disc-codigo').value = '';
                document.getElementById('disc-nome').value = '';
                document.getElementById('disc-ch').value = '';
                loadDisciplinas();
                loadCounts();
            }).catch(error => {
                alert('Erro ao adicionar disciplina: ' + error.message);
            });
        }

        function addTurma() {
            const codigo = document.getElementById('turma-codigo').value;
            const semestre = document.getElementById('turma-semestre').value;
            const turno = document.getElementById('turma-turno').value;
            
            if (!codigo || !semestre || !turno) {
                alert('Por favor, preencha todos os campos');
                return;
            }
            
            // Validação do semestre conforme turno
            const maxSemestre = turno === 'matutino' ? 9 : 10;
            if (semestre < 1 || semestre > maxSemestre) {
                alert(`Semestre inválido! Para o turno ${turno}, os semestres devem ser entre 1 e ${maxSemestre}`);
                return;
            }
            
            turmasRef.add({
                codigo: codigo,
                semestre: parseInt(semestre),
                turno: turno
            }).then(() => {
                alert('Turma adicionada com sucesso!');
                document.getElementById('turma-semestre').value = '';
                loadTurmas();
                loadCounts();
            }).catch(error => {
                alert('Erro ao adicionar turma: ' + error.message);
            });
        }

        function addSala() {
            const nome = document.getElementById('sala-nome').value;
            const capacidade = document.getElementById('sala-capacidade').value;
            const tipo = document.getElementById('sala-tipo').value;
            
            if (!nome || !capacidade || !tipo) {
                alert('Por favor, preencha todos os campos');
                return;
            }
            
            salasRef.add({
                nome: nome,
                capacidade: parseInt(capacidade),
                tipo: tipo
            }).then(() => {
                alert('Sala adicionada com sucesso!');
                document.getElementById('sala-nome').value = '';
                document.getElementById('sala-capacidade').value = '';
                loadSalas();
                loadCounts();
            }).catch(error => {
                alert('Erro ao adicionar sala: ' + error.message);
            });
        }

        // Função para adicionar horário com verificação de conflito
        async function addHorario() {
            const turmaId = document.getElementById('horario-turma').value;
            const disciplinaId = document.getElementById('horario-disciplina').value;
            const professorId = document.getElementById('horario-professor').value;
            const salaId = document.getElementById('horario-sala').value;
            const dia = document.getElementById('horario-dia').value;
            const inicio = document.getElementById('horario-inicio').value;
            const duracao = parseInt(document.getElementById('horario-duracao').value);
            
            if (!turmaId || !disciplinaId || !professorId || !salaId || !dia || !inicio) {
                alert('Por favor, preencha todos os campos');
                return;
            }
            
            // Converter horário para minutos para facilitar comparação
            const [hora, minuto] = inicio.split(':').map(Number);
            const inicioMinutos = hora * 60 + minuto;
            const fimMinutos = inicioMinutos + (duracao * 50); // Cada período tem 50 minutos
            
            // Verificar conflitos
            const conflictAlert = document.getElementById('conflict-alert');
            conflictAlert.style.display = 'none';
            
            const hasConflict = await checkScheduleConflict(professorId, salaId, dia, inicioMinutos, fimMinutos);
            
            if (hasConflict) {
                conflictAlert.innerHTML = 'Conflito de horário detectado! Não foi possível adicionar.';
                conflictAlert.style.display = 'block';
                return;
            }
            
            // Adicionar horário se não houver conflito
            horariosRef.add({
                turmaId: turmaId,
                disciplinaId: disciplinaId,
                professorId: professorId,
                salaId: salaId,
                dia: dia,
                inicio: inicio,
                duracao: duracao,
                inicioMinutos: inicioMinutos,
                fimMinutos: fimMinutos
            }).then(() => {
                alert('Horário adicionado com sucesso!');
                generateScheduleGrid(turmaId); // Atualizar grade de horários
            }).catch(error => {
                alert('Erro ao adicionar horário: ' + error.message);
            });
        }

        // Função para verificar conflitos de horário
        async function checkScheduleConflict(professorId, salaId, dia, inicioMinutos, fimMinutos) {
            let hasConflict = false;
            
            // Verificar conflitos para o professor
            const professorSnap = await horariosRef
                .where('professorId', '==', professorId)
                .where('dia', '==', dia)
                .get();
            
            professorSnap.forEach(doc => {
                const horario = doc.data();
                if ((inicioMinutos >= horario.inicioMinutos && inicioMinutos < horario.fimMinutos) ||
                    (fimMinutos > horario.inicioMinutos && fimMinutos <= horario.fimMinutos) ||
                    (inicioMinutos <= horario.inicioMinutos && fimMinutos >= horario.fimMinutos)) {
                    hasConflict = true;
                }
            });
            
            // Verificar conflitos para a sala
            const salaSnap = await horariosRef
                .where('salaId', '==', salaId)
                .where('dia', '==', dia)
                .get();
            
            salaSnap.forEach(doc => {
                const horario = doc.data();
                if ((inicioMinutos >= horario.inicioMinutos && inicioMinutos < horario.fimMinutos) ||
                    (fimMinutos > horario.inicioMinutos && fimMinutos <= horario.fimMinutos) ||
                    (inicioMinutos <= horario.inicioMinutos && fimMinutos >= horario.fimMinutos)) {
                    hasConflict = true;
                }
            });
            
            return hasConflict;
        }

        // Função para gerar grade de horários
        async function generateScheduleGrid(turmaId) {
            const container = document.getElementById('schedule-container');
            container.innerHTML = '<div class="loading">Carregando grade de horários...</div>';
            
            // Obter todos os horários para esta turma
            const horariosSnap = await horariosRef.where('turmaId', '==', turmaId).get();
            
            if (horariosSnap.empty) {
                container.innerHTML = '<p>Nenhum horário cadastrado para esta turma.</p>';
                return;
            }
            
            // Obter informações da turma
            const turmaDoc = await turmasRef.doc(turmaId).get();
            const turma = turmaDoc.data();
            
            // Definir horários baseados no turno
            const horarios = turma.turno === 'matutino' ? 
                ['07:30', '08:20', '09:10', '10:00', '10:50', '11:40'] : 
                ['18:40', '19:30', '20:20', '21:10'];
            
            // Dias da semana
            const dias = ['segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado'];
            const diasNomes = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            
            // Criar estrutura da grade
            let gridHTML = `
                <div class="schedule-grid">
                    <div class="grid-header"></div> <!-- Canto superior esquerdo -->
            `;
            
            // Adicionar cabeçalhos dos dias
            diasNomes.forEach(dia => {
                gridHTML += `<div class="grid-header">${dia}</div>`;
            });
            
            // Preencher grade com horários
            horarios.forEach((hora, index) => {
                gridHTML += `<div class="grid-header">${hora}</div>`;
                
                // Adicionar células para cada dia
                dias.forEach(dia => {
                    const horariosDia = [];
                    
                    // Verificar se há horário neste dia e hora
                    horariosSnap.forEach(doc => {
                        const horario = doc.data();
                        if (horario.dia === dia && horario.inicio === hora) {
                            // Obter detalhes da disciplina
                            disciplinasRef.doc(horario.disciplinaId).get().then(discDoc => {
                                if (discDoc.exists) {
                                    horario.disciplina = discDoc.data();
                                }
                            });
                            
                            // Obter detalhes do professor
                            professoresRef.doc(horario.professorId).get().then(profDoc => {
                                if (profDoc.exists) {
                                    horario.professor = profDoc.data();
                                }
                            });
                            
                            // Obter detalhes da sala
                            salasRef.doc(horario.salaId).get().then(salaDoc => {
                                if (salaDoc.exists) {
                                    horario.sala = salaDoc.data();
                                }
                            });
                            
                            horariosDia.push(horario);
                        }
                    });
                    
                    if (horariosDia.length > 0) {
                        let cellContent = '';
                        horariosDia.forEach(h => {
                            cellContent += `
                                <div class="schedule-entry">
                                    <strong>${h.disciplina?.codigo || '???'}</strong> - ${h.disciplina?.nome || 'Disciplina não encontrada'}
                                    <div>Prof: ${h.professor?.nome || '???'}</div>
                                    <div>Sala: ${h.sala?.nome || '???'}</div>
                                </div>
                            `;
                        });
                        
                        gridHTML += `<div class="grid-cell">${cellContent}</div>`;
                    } else {
                        gridHTML += `<div class="grid-cell"></div>`;
                    }
                });
            });
            
            gridHTML += '</div>'; // Fechar schedule-grid
            container.innerHTML = gridHTML;
        }

        // Função para carregar dados para impressão
        function loadPrintData() {
            // Carregar turmas para impressão
            const printTurmaSelect = document.getElementById('print-turma');
            printTurmaSelect.innerHTML = '<option value="">Carregando turmas...</option>';
            
            turmasRef.get().then(snap => {
                printTurmaSelect.innerHTML = '<option value="">Selecione uma turma</option>';
                snap.forEach(doc => {
                    const turma = doc.data();
                    printTurmaSelect.innerHTML += `<option value="${doc.id}">${turma.codigo} - ${turma.semestre}º Semestre (${turma.turno})</option>`;
                });
            });
            
            // Carregar professores para impressão
            const printProfSelect = document.getElementById('print-professor');
            printProfSelect.innerHTML = '<option value="">Carregando professores...</option>';
            
            professoresRef.get().then(snap => {
                printProfSelect.innerHTML = '<option value="">Selecione um professor</option>';
                snap.forEach(doc => {
                    const prof = doc.data();
                    printProfSelect.innerHTML += `<option value="${doc.id}">${prof.nome}</option>`;
                });
            });
        }

        // Função para gerar relatório para impressão
        async function generatePrint() {
            const printType = document.getElementById('print-type').value;
            const printOutput = document.getElementById('print-output');
            printOutput.innerHTML = '<div class="loading">Gerando relatório...</div>';
            
            if (printType === 'turma') {
                const turmaId = document.getElementById('print-turma').value;
                if (!turmaId) {
                    printOutput.innerHTML = '<div class="error">Selecione uma turma</div>';
                    return;
                }
                
                // Obter informações da turma
                const turmaDoc = await turmasRef.doc(turmaId).get();
                const turma = turmaDoc.data();
                
                // Obter horários da turma
                const horariosSnap = await horariosRef.where('turmaId', '==', turmaId).get();
                
                // Criar conteúdo para impressão
                let printHTML = `
                    <h3>Horário da Turma: ${turma.codigo}</h3>
                    <p>Semestre: ${turma.semestre}º | Turno: ${turma.turno === 'matutino' ? 'Matutino' : 'Noturno'}</p>
                    <div class="schedule-grid">
                        <div class="grid-header"></div>
                        <div class="grid-header">Segunda</div>
                        <div class="grid-header">Terça</div>
                        <div class="grid-header">Quarta</div>
                        <div class="grid-header">Quinta</div>
                        <div class="grid-header">Sexta</div>
                        <div class="grid-header">Sábado</div>
                `;
                
                // Definir horários baseados no turno
                const horarios = turma.turno === 'matutino' ? 
                    ['07:30', '08:20', '09:10', '10:00', '10:50', '11:40'] : 
                    ['18:40', '19:30', '20:20', '21:10'];
                
                // Preencher grade de impressão
                for (const hora of horarios) {
                    printHTML += `<div class="grid-header">${hora}</div>`;
                    
                    for (const dia of ['segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado']) {
                        let cellContent = '';
                        
                        horariosSnap.forEach(doc => {
                            const horario = doc.data();
                            if (horario.dia === dia && horario.inicio === hora) {
                                // Obter detalhes da disciplina
                                const discDoc = disciplinasRef.doc(horario.disciplinaId);
                                discDoc.get().then(discData => {
                                    if (discData.exists) {
                                        horario.disciplina = discData.data();
                                    }
                                });
                                
                                cellContent += `
                                    <div class="schedule-entry">
                                        <strong>${horario.disciplina?.codigo || '???'}</strong>
                                        <div>${horario.disciplina?.nome || 'Disciplina não encontrada'}</div>
                                        <div>${horario.sala?.nome || '???'}</div>
                                    </div>
                                `;
                            }
                        });
                        
                        printHTML += `<div class="grid-cell">${cellContent}</div>`;
                    }
                }
                
                printHTML += '</div>'; // Fechar schedule-grid
                printHTML += `<button onclick="window.print()" class="btn-success" style="margin-top: 20px;">Imprimir Horário</button>`;
                printOutput.innerHTML = printHTML;
            } else {
                const professorId = document.getElementById('print-professor').value;
                if (!professorId) {
                    printOutput.innerHTML = '<div class="error">Selecione um professor</div>';
                    return;
                }
                
                // Obter informações do professor
                const professorDoc = await professoresRef.doc(professorId).get();
                const professor = professorDoc.data();
                
                // Obter horários do professor
                const horariosSnap = await horariosRef.where('professorId', '==', professorId).get();
                
                // Criar conteúdo para impressão
                let printHTML = `
                    <h3>Horário do Professor: ${professor.nome}</h3>
                    <div class="schedule-grid">
                        <div class="grid-header"></div>
                        <div class="grid-header">Segunda</div>
                        <div class="grid-header">Terça</div>
                        <div class="grid-header">Quarta</div>
                        <div class="grid-header">Quinta</div>
                        <div class="grid-header">Sexta</div>
                        <div class="grid-header">Sábado</div>
                `;
                
                // Definir todos os horários possíveis
                const horarios = ['07:30', '08:20', '09:10', '10:00', '10:50', '11:40', '18:40', '19:30', '20:20', '21:10'];
                
                // Preencher grade de impressão
                for (const hora of horarios) {
                    printHTML += `<div class="grid-header">${hora}</div>`;
                    
                    for (const dia of ['segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado']) {
                        let cellContent = '';
                        
                        horariosSnap.forEach(doc => {
                            const horario = doc.data();
                            if (horario.dia === dia && horario.inicio === hora) {
                                // Obter detalhes da disciplina
                                const discDoc = disciplinasRef.doc(horario.disciplinaId);
                                discDoc.get().then(discData => {
                                    if (discData.exists) {
                                        horario.disciplina = discData.data();
                                    }
                                });
                                
                                // Obter detalhes da turma
                                const turmaDoc = turmasRef.doc(horario.turmaId);
                                turmaDoc.get().then(turmaData => {
                                    if (turmaData.exists) {
                                        horario.turma = turmaData.data();
                                    }
                                });
                                
                                cellContent += `
                                    <div class="schedule-entry">
                                        <strong>${horario.disciplina?.codigo || '???'}</strong>
                                        <div>${horario.turma?.codigo || '???'} - ${horario.sala?.nome || '???'}</div>
                                    </div>
                                `;
                            }
                        });
                        
                        printHTML += `<div class="grid-cell">${cellContent}</div>`;
                    }
                }
                
                printHTML += '</div>'; // Fechar schedule-grid
                printHTML += `<button onclick="window.print()" class="btn-success" style="margin-top: 20px;">Imprimir Horário</button>`;
                printOutput.innerHTML = printHTML;
            }
        }
    </script>
</body>
</html>
